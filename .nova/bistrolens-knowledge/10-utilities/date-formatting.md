# Date Formatting Patterns

## Source
Extracted from BistroLens `components/` and `services/` — date display patterns used throughout the app.

---

## Pattern: Date Formatting Utilities

BistroLens uses native JavaScript `Date` APIs for all date formatting — no external date libraries (no dayjs, no moment.js). Patterns range from simple locale-aware display to relative time formatting.

---

## Core Patterns

### 1. Basic Date Display

```typescript
// Display a stored timestamp as a readable date
const displayDate = (timestamp: number | string): string => {
  return new Date(timestamp).toLocaleDateString();
};

// With explicit locale options
const displayDateVerbose = (timestamp: number | string): string => {
  return new Date(timestamp).toLocaleDateString(undefined, {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
};

// Usage in components
<span>{new Date(post.createdAt).toLocaleDateString()}</span>
<span>{new Date(entry.date).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' })}</span>
```

### 2. Date + Time Display

```typescript
// Show both date and time (used in NotificationCenter)
const displayDateTime = (timestamp: number): string => {
  const date = new Date(timestamp).toLocaleDateString();
  const time = new Date(timestamp).toLocaleTimeString([], {
    hour: '2-digit',
    minute: '2-digit',
  });
  return `${date} at ${time}`;
};

// Usage
<p>{new Date(n.timestamp).toLocaleDateString()} at {new Date(n.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}</p>
```

### 3. Relative Time Formatting

```typescript
// Relative time display (used in SecurityDashboard, SmartNotificationCenter)
const formatRelativeTime = (timestamp: number): string => {
  const diff = Date.now() - timestamp;
  const minutes = Math.floor(diff / 60000);
  const hours = Math.floor(diff / 3600000);
  const days = Math.floor(diff / 86400000);

  if (diff < 3600000) return `${minutes}m ago`;       // < 1 hour
  if (diff < 86400000) return `${hours}h ago`;         // < 1 day
  return new Date(timestamp).toLocaleDateString();     // fallback to date
};

// Usage
const timeAgo = formatRelativeTime(notification.timestamp);
```

### 4. Current Day Detection

```typescript
// Check if a date matches today (used in MealPlanner)
const isToday = (dayName: string): boolean => {
  return new Date().toLocaleDateString('en-US', { weekday: 'long' }) === dayName;
};

// Usage
const isToday = new Date().toLocaleDateString('en-US', { weekday: 'long' }) === day;
```

### 5. Dynamic Date in Labels

```typescript
// Auto-generate names with current date (used in MealPlanService)
const generatePlanName = (customName?: string): string => {
  return customName || `Week of ${new Date().toLocaleDateString()}`;
};

// Footer/export timestamps
const exportFooter = `Generated by Bistro Lens • ${new Date().toLocaleDateString()}`;
```

### 6. ISO String for Storage

```typescript
// Store dates as ISO strings in Convex/localStorage
const storeDate = (): string => new Date().toISOString();

// Parse back for display
const displayStoredDate = (isoString: string): string => {
  return new Date(isoString).toLocaleDateString();
};
```

---

## Anti-Patterns

### ❌ Don't Do This

```typescript
// Don't hardcode locale strings
const date = new Date(ts).toLocaleDateString('en-US'); // Breaks for international users

// Don't use moment.js or dayjs (not in the project)
import dayjs from 'dayjs'; // ❌ Not installed

// Don't format dates manually
const month = date.getMonth() + 1; // Error-prone, no locale support
const formatted = `${month}/${date.getDate()}/${date.getFullYear()}`; // ❌
```

### ✅ Do This Instead

```typescript
// Use undefined locale to respect user's system locale
new Date(ts).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' });

// Use relative time for recent events, absolute for older ones
const display = diff < 86400000
  ? `${Math.floor(diff / 3600000)}h ago`
  : new Date(ts).toLocaleDateString();
```

---

## When to Use This Pattern

✅ **Use for:**
- Displaying timestamps from Convex documents
- Showing "created at", "updated at", "joined" dates
- Notification timestamps
- Export/PDF footers with generation date
- Meal plan names with current week

❌ **Don't use for:**
- Complex date arithmetic (use a library if needed)
- Calendar/scheduling features requiring timezone handling
- Date range pickers (use a dedicated component)

---

## Benefits

1. Zero dependencies — native `Date` API works everywhere
2. Automatic locale support via `toLocaleDateString(undefined, ...)`
3. Consistent pattern across the entire codebase
4. Handles both number timestamps and ISO strings

---

## Related Patterns

- See `number-formatting.md` for numeric display patterns
- See `string-utilities.md` for text manipulation
- See `../09-hooks/useLocalStorage.md` for persisting date values

---

*Extracted: 2026-02-18*
